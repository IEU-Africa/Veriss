<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Payment Records - Veriss Payments</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <link rel="stylesheet" href="assets/css/app.css">
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="assets/js/auth.js"></script>
    <script src="assets/js/user.js"></script>
  </head>

  <body class="bg-gradient-to-br from-neutral-50 to-neutral-100">
    <div id="app" class="min-h-screen">
      <!-- Enhanced Payment Records Header -->
      <header class="modern-header" style="background: linear-gradient(135deg, #16a34a 0%, #15803d 50%, #14532d 100%); box-shadow: 0 4px 20px rgba(22, 163, 74, 0.25);">
        <div class="modern-container flex justify-between items-center">
          <h1 class="text-2xl font-bold text-white flex items-center gap-3">
            <div class="w-10 h-10 rounded-xl bg-white/20 backdrop-blur-sm flex items-center justify-center">
              <i data-lucide="file-text" class="w-6 h-6"></i>
            </div>
            Payment Records
          </h1>
          <a href="user-dashboard.html" class="btn btn-outline text-white border-2 border-white hover:bg-white hover:text-success-700 font-semibold">
            <i data-lucide="arrow-left" class="w-4 h-4"></i>
            Back to Dashboard
          </a>
        </div>
      </header>

      <main class="modern-container py-10">
        <div class="modern-card">
          <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 gap-4">
            <h2 class="text-2xl font-bold text-neutral-900 flex items-center gap-2">
              <i data-lucide="history" class="w-6 h-6 text-primary-600"></i>
              Your Payment History
            </h2>
            <button @click="downloadRecords" class="btn btn-primary">
              <i data-lucide="download" class="w-5 h-5"></i>
              Download Records
            </button>
          </div>

          <div class="mb-6 flex flex-col sm:flex-row gap-4">
            <div class="flex-1 relative">
              <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                <i data-lucide="search" class="w-5 h-5 text-neutral-400"></i>
              </div>
              <input v-model="searchTerm" type="text" placeholder="Search payments..."
                class="modern-input pl-10">
            </div>
            <select v-model="statusFilter" class="modern-input w-full sm:w-auto min-w-[150px]">
              <option value="">All Status</option>
              <option value="paid">Paid</option>
              <option value="pending">Pending</option>
              <option value="failed">Failed</option>
            </select>
          </div>

          <div class="overflow-x-auto">
            <table class="modern-table">
              <thead>
                <tr>
                  <th>Date</th>
                  <th>Description</th>
                  <th>Amount</th>
                  <th>Status</th>
                  <th>Transaction ID</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <tr v-for="payment in filteredPayments">
                  <td class="font-medium">{{ payment.paymentDate || 'N/A' }}</td>
                  <td>{{ payment.dueTitle || 'Monthly Due' }}</td>
                  <td class="font-semibold">₦{{ payment.amount?.toLocaleString() || 0 }}</td>
                  <td>
                    <span :class="getStatusClass(payment.status)" class="status-badge">
                      {{ payment.status }}
                    </span>
                  </td>
                  <td class="font-mono text-sm">{{ payment.transactionId || 'N/A' }}</td>
                  <td>
                    <button v-if="payment.status === 'paid'" @click="viewReceipt(payment)"
                      class="modern-link font-medium">
                      <i data-lucide="receipt" class="w-4 h-4 inline"></i>
                      View Receipt
                    </button>
                    <span v-else class="text-neutral-400">-</span>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>

          <div v-if="filteredPayments.length === 0" class="empty-state">
            <i data-lucide="file-x" class="w-16 h-16 text-neutral-400 mx-auto mb-4"></i>
            <p class="text-lg font-medium text-neutral-700">No payment records found</p>
            <p class="text-neutral-500">Your payment history will appear here</p>
          </div>
        </div>
      </main>
    </div>

    <script>
      const { createApp } = Vue;

      createApp({
        data() {
          return {
            payments: [],
            searchTerm: '',
            statusFilter: ''
          }
        },
        mounted() {
          lucide.createIcons();
          const user = getCurrentUser();
          if (user && user.role === 'user') {
            this.payments = getPaymentRecords(user.id);
          } else {
            window.location.href = 'login.html';
          }
        },
        updated() {
          lucide.createIcons();
        },
        computed: {
          filteredPayments() {
            return this.payments.filter(payment => {
              const matchesSearch = !this.searchTerm ||
                payment.dueTitle?.toLowerCase().includes(this.searchTerm.toLowerCase()) ||
                payment.transactionId?.toLowerCase().includes(this.searchTerm.toLowerCase());
              const matchesStatus = !this.statusFilter || payment.status === this.statusFilter;
              return matchesSearch && matchesStatus;
            });
          }
        },
        methods: {
          getStatusClass(status) {
            return {
              'paid': 'status-paid',
              'pending': 'status-pending',
              'failed': 'status-failed'
            }[status] || 'bg-neutral-100 text-neutral-800';
          },
          viewReceipt(payment) {
            // Mock receipt view - in real app, open modal or new page
            alert(`Receipt for payment of ₦${payment.amount}\nTransaction ID: ${payment.transactionId}\nDate: ${payment.paymentDate}`);
          },
          downloadRecords() {
            // Mock download - in real app, generate CSV or PDF
            alert('Download functionality would generate a CSV file with your payment records.');
          }
        }
      }).mount('#app');
    </script>
  </body>

</html>