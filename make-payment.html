<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Make Payment - Veriss Payments</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <link rel="stylesheet" href="assets/css/app.css">
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="assets/js/auth.js"></script>
    <script src="assets/js/user.js"></script>
  </head>

  <body class="bg-gradient-to-br from-neutral-50 to-neutral-100">
    <div id="app" class="min-h-screen">
      <!-- Enhanced Make Payment Header -->
      <header class="modern-header" style="background: linear-gradient(135deg, #16a34a 0%, #15803d 50%, #14532d 100%); box-shadow: 0 4px 20px rgba(22, 163, 74, 0.25);">
        <div class="modern-container flex justify-between items-center">
          <h1 class="text-2xl font-bold text-white flex items-center gap-3">
            <div class="w-10 h-10 rounded-xl bg-white/20 backdrop-blur-sm flex items-center justify-center">
              <i data-lucide="credit-card" class="w-6 h-6"></i>
            </div>
            Make Payment
          </h1>
          <a href="user-dashboard.html" class="btn btn-outline text-white border-2 border-white hover:bg-white hover:text-success-700 font-semibold">
            <i data-lucide="arrow-left" class="w-4 h-4"></i>
            Back to Dashboard
          </a>
        </div>
      </header>

      <main class="modern-container py-10">
        <div class="max-w-2xl mx-auto">
          <div class="modern-card mb-6">
            <h2 class="text-xl font-semibold mb-6 flex items-center gap-2 text-neutral-900">
              <i data-lucide="search" class="w-5 h-5 text-primary-600"></i>
              Search for Dues
            </h2>
            <div class="flex gap-4">
              <div class="flex-1 relative">
                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                  <i data-lucide="mail" class="w-5 h-5 text-neutral-400"></i>
                </div>
                <input v-model="searchEmail" type="email" placeholder="Enter your email"
                  class="modern-input pl-10">
              </div>
              <button @click="searchDues" class="btn btn-primary px-8">
                <i data-lucide="search" class="w-5 h-5"></i>
                Search
              </button>
            </div>
          </div>

          <div v-if="selectedDue" class="modern-card mb-6">
            <h2 class="text-xl font-semibold mb-6 flex items-center gap-2 text-neutral-900">
              <i data-lucide="receipt" class="w-5 h-5 text-primary-600"></i>
              Payment Breakdown
            </h2>
            <div class="space-y-4">
              <div class="flex justify-between items-center p-4 bg-neutral-50 rounded-lg">
                <span class="font-medium text-neutral-900">{{ selectedDue.title }}</span>
                <span class="font-bold text-lg text-neutral-900">₦{{ selectedDue.amount?.toLocaleString() || 0 }}</span>
              </div>
              <div v-for="sub in selectedDue.subDeductions" class="flex justify-between items-center p-3 text-sm text-neutral-600 border-b border-neutral-200">
                <span>{{ sub.name }}</span>
                <span class="font-medium">₦{{ sub.amount?.toLocaleString() || 0 }}</span>
              </div>
              <div class="flex justify-between items-center pt-4 border-t-2 border-neutral-300">
                <span class="font-bold text-lg text-neutral-900">Total Amount</span>
                <span class="font-bold text-2xl text-primary-600">₦{{ calculateTotal().toLocaleString() }}</span>
              </div>
            </div>

            <button @click="initiatePayment" class="btn btn-success w-full mt-6 py-4 text-lg">
              <i data-lucide="credit-card" class="w-5 h-5"></i>
              Pay with Paystack
            </button>
          </div>

          <div v-if="paymentStatus" class="modern-card">
            <h2 class="text-xl font-semibold mb-6 flex items-center gap-2 text-neutral-900">
              <i data-lucide="check-circle" class="w-5 h-5" :class="paymentStatus === 'Success' ? 'text-success-600' : paymentStatus === 'Failed' ? 'text-error-600' : 'text-warning-600'"></i>
              Payment Status
            </h2>
            <div class="text-center">
              <div :class="paymentStatusClass" class="inline-block px-6 py-3 rounded-lg text-white font-semibold text-lg mb-4">
                {{ paymentStatus }}
              </div>
              <p v-if="paymentStatus === 'Success'" class="mt-4 text-success-600 font-medium">
                Payment successful! Transaction ID: {{ transactionId }}
              </p>
              <p v-if="paymentStatus === 'Success'" class="mt-4">
                <a href="payment-records.html" class="modern-link font-semibold">
                  <i data-lucide="file-text" class="w-4 h-4 inline"></i>
                  View Receipt
                </a>
              </p>
            </div>
          </div>
        </div>
      </main>
    </div>

    <script>
      const { createApp } = Vue;

      createApp({
        data() {
          return {
            searchEmail: '',
            selectedDue: null,
            paymentStatus: null,
            transactionId: null
          }
        },
        computed: {
          paymentStatusClass() {
            return {
              'Success': 'bg-success-600',
              'Pending': 'bg-warning-500',
              'Failed': 'bg-error-600'
            }[this.paymentStatus] || 'bg-neutral-500';
          }
        },
        mounted() {
          lucide.createIcons();
          const user = getCurrentUser();
          if (!user || user.role !== 'user') {
            window.location.href = 'login.html';
          }
        },
        updated() {
          lucide.createIcons();
        },
        methods: {
          searchDues() {
            if (this.searchEmail) {
              // Mock search - in real app, this would call API
              this.selectedDue = {
                id: 1,
                title: 'Monthly Dues',
                amount: 5000,
                subDeductions: [
                  { name: 'Security', amount: 1000 },
                  { name: 'Maintenance', amount: 2000 }
                ]
              };
            }
          },
          calculateTotal() {
            if (!this.selectedDue) return 0;
            const subTotal = this.selectedDue.subDeductions.reduce((sum, sub) => sum + sub.amount, 0);
            return this.selectedDue.amount + subTotal;
          },
          initiatePayment() {
            // Mock Paystack integration
            this.paymentStatus = 'Pending';
            setTimeout(() => {
              this.paymentStatus = 'Success';
              this.transactionId = 'TXN' + Date.now();
              // In real app, update payment record
              const user = getCurrentUser();
              makePayment({
                userId: user.id,
                orgId: 1,
                dueId: this.selectedDue.id,
                amount: this.calculateTotal()
              });
            }, 2000);
          }
        }
      }).mount('#app');
    </script>
  </body>

</html>